import{s as w,e as I,a as u}from"./style-3a8f6227.js";const y=async(e,n={})=>{const o=await fetch(e,n);if(!o.ok)throw new Error(`Error ${o.status} occured`);return o.json()},q=async()=>{const e=localStorage.getItem("token");if(console.log(e),!e)console.log(window.location.href),window.location.href.includes("login-admin.html")||(window.location.href="login-admin.html");else return!0};q();const D=await y(u+"api/dish");D.forEach(e=>{const o=(()=>{let t=`
		<h2 id="${e.category_name}">${e.category_name}</h2>
		<ul class="menu-list">
	`;return e.dishes.forEach(r=>{const{dish_name:a,dish_price:l,dish_photo:d,dish_id:f}=r;t+=`
			<li class="menu-item" data-dish-id=${f}>
			<img class="menu-img" src="${u+"media/"+d}" alt="drink">
			<div class="menu-item-info">
				<p class="menu-item-name">${a}</p>
				<p class="menu-item-price">${l}</p>
			</div>

		`,document.querySelector(".menu-container")?.classList.contains("menu-admin")&&(t+=`<div class="menu-item-btns"><button class="menu-modify-btn button">Muokkaa</button>
			<button class="menu-delete-btn button">Poista</button></div>`),document.querySelector(".menu-container")?.classList.contains("offer-admin")&&(t+=`<div class="menu-item-btns"><button id="offer-activate" class="button">Aktivoi</button>
			<button id="offer-delete" class="button">Poista</button></div>`),t+="	</li>"}),t+=`

	</ul>
	`,t})();document.querySelector(".menu-items")?.insertAdjacentHTML("beforeend",o)});const L=async(e,n,o)=>{console.log(o);try{return await y(u+`api/dish/${n}`,{method:"PUT",headers:{Authorization:"Bearer "+e},body:o})}catch(t){throw console.error("Error modifying item:",t),t}},_=document.querySelectorAll(".menu-item");let i;_.forEach(e=>{e.addEventListener("click",n=>{i=n.currentTarget.dataset.dishId,console.log(i)})});const c=document.querySelector("#info");if(!c)throw new Error("Info dialog not found");document.getElementById("item-modify-form")?.addEventListener("submit",async e=>{if(console.log("sumit"),console.log(),e.preventDefault(),i){const n=localStorage.getItem("token");if(!n)return;const o=parseInt(i);console.log(o);const t=document.querySelector('#modify-item-dialog input[name="dish_name"]'),r=document.querySelector('#modify-item-dialog input[name="dish_price"]'),a=document.querySelector('#modify-item-dialog textarea[name="description"]'),l=document.querySelector('#modify-item-dialog select[name="category_id"]'),d=document.querySelector('#modify-item-dialog input[name="dish_photo"]');if(!t||!r||!a||!l||!d?.files)return;const f=t?.value,b=r?.value,E=a?.value,k=l?.value,v=d?.files?.[0],s=new FormData;s.append("dish_name",f),s.append("dish_price",b),s.append("description",E),s.append("category_id",k),s.append("dish_photo",v);try{const m=await L(n,o,s);console.log(m);const h="PÃ¤ivitys onnistui!";c.innerHTML=w(h),c.showModal(),document.querySelector("#back-btn-success")?.addEventListener("click",()=>{c?.close()}),g?.close(),location.reload()}catch(m){console.error("Error modifying item:",m);const h=m.message;c.innerHTML=I(h),c.showModal(),document.querySelector("#back-btn-error")?.addEventListener("click",()=>{c?.close()})}}});const M=async(e,n)=>{console.log(n);try{return await y(u+`api/dish/${n}`,{method:"DELETE",headers:{Authorization:"Bearer "+e}})}catch(o){console.error("Error deleting item:",o)}};document.getElementById("item-delete-form")?.addEventListener("submit",async e=>{if(e.preventDefault(),i){const n=parseInt(i);console.log(n);const o=localStorage.getItem("token");if(!o)return;try{const t=await M(o,n);console.log(t)}catch(t){throw console.error("Error deleting item:",t),t}p?.close(),location.reload()}});const g=document.querySelector("#modify-item-dialog"),p=document.querySelector("#delete-item-dialog"),B=document.querySelectorAll(".menu-modify-btn"),T=document.querySelectorAll(".menu-delete-btn");B?.forEach(e=>{e.addEventListener("click",()=>{g?.showModal()})});T?.forEach(e=>{e.addEventListener("click",()=>{p?.showModal()})});const $=document.querySelector("#modify-back-btn");$.addEventListener("click",()=>{g?.close()});const A=document.querySelector("#delete-back-btn");A.addEventListener("click",()=>{p?.close()});
