import{e as b,s as k,a as l,m as D,b as E}from"./style-ce433336.js";import{f as h}from"./function-19f4931a.js";const f=async(e,t={})=>{const o=await fetch(e,t);if(!o.ok)throw new Error(`Error ${o.status} occured`);return o.json()},w=await f(l+"api/dish");w.forEach(e=>{const o=(()=>{let n=`
		<h2 id="${e.category_name}">${e.category_name}</h2>
		<ul class="menu-list">
		`;return e.dishes.forEach(i=>{const{dish_photo:m,dish_name:u,dish_price:c,dish_id:r}=i;n+=`
			<li class="menu-item" data-dish-id=${r}>
			<img class="menu-img" src="${l+"media/"+m}" alt="drink">
			<div>
			<p class="menu-item-name">${u}</p>
			<p class="menu-item-price">${c}</p>
			</div>
			</li>
			`}),n+=`
		</ul>
		`,n})();document.querySelector(".menu-items")?.insertAdjacentHTML("beforeend",o)});const T=async e=>{try{let t;const o=localStorage.getItem("token");return o?t=await z(o,e):t=await f(l+`api/dish/${e}`),t}catch(t){return console.error(`Error fetching dish details for dish_id ${e}:`,t),null}},L=document.querySelectorAll(".menu-item");L.forEach(e=>{e.addEventListener("click",t=>{const o=t.currentTarget.dataset.dishId;console.log(o),o&&p(Number(o))})});const p=async e=>{const t=await T(e);if(t){console.log("Dish Details:",t);const{dish_photo:o,dish_name:n,dish_price:i,dish_id:m,description:u,offer_price:c}=t,r=`
		<div class="menu-item" data-dish-id="${m}">
		  <img class="menu-img" src="${l+"media/"+o}" alt="drink">
		  <div>
			<p class="menu-item-name">${n}</p>
			<p>${u}</p>
			<p class="menu-item-price">${c??i}</p>
		  </div>
		</div>
	  `,s=document.querySelector(".info-item");s?(s.innerHTML="",s.insertAdjacentHTML("beforeend",r)):console.error("infoItemContainer is null")}else console.log("Unable to fetch dish details")},y=document.querySelector("dialog"),S=document.querySelector("#product-info-dialog"),d=document.querySelector("#login-dialog"),M=document.querySelector("#shopping-cart-dialog"),a=document.querySelector("#info"),q=document.querySelectorAll(".menu-item");console.log(q);q.forEach(e=>{e.addEventListener("click",()=>{S?.showModal()}),document.body.style.overflow="auto"});const I=document.querySelector("#shopping-cart-icon");I?.addEventListener("click",()=>{M?.showModal(),document.body.style.overflow="auto"});const j=document.querySelector("#back-btn-info");j.addEventListener("click",()=>{y?.close()});const B=document.querySelector("#back-btn-login");B.addEventListener("click",()=>{d?.close()});const $=document.querySelector("#back-btn-cart");$.addEventListener("click",()=>{y?.close()});const H=document.querySelector("#quantity-plus");H.addEventListener("click",()=>{const e=document.querySelector(".quantity-number");let t=parseInt(e.value);t++,e.value=t.toString()});const O=document.querySelector("#quantity-minus");O.addEventListener("click",()=>{const e=document.querySelector(".quantity-number");let t=parseInt(e.value);t--,e.value=t.toString()});const g=document.querySelector("#login-form"),_=document.querySelector("#profile-icon"),A=document.querySelector("#login");if(!A)throw new Error("Login button not found");if(!a)throw new Error("Dialog not found");const C=async e=>{const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return await h(l+"api/auth/login",t)},N=async e=>{const t={method:"GET",headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"}};return await h(l+"api/dish/offers",t)},x=async e=>{const t={method:"GET",headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"}};return await h(l+"api/dish/logged",t)},z=async(e,t)=>{const o={method:"GET",headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"}};return await h(l+"api/dish/"+t,o)},v=async()=>{const e=localStorage.getItem("token");if(!e)return;const t=await N(e),o=document.querySelector(".menu-items");o&&(o.innerHTML=""),(c=>{const r=document.querySelector(".menu-items"),s=D(c.offer_dishes);console.log(c),r?.insertAdjacentHTML("afterbegin",s),document.querySelector(".nav-item.discount")?.classList.remove("hidden")})(t);const i=await x(e);console.log(i),(c=>{const r=document.querySelector(".menu-items"),s=E(c);r?.insertAdjacentHTML("beforeend",s)})(i);const u=document.querySelectorAll(".menu-item");console.log(u),u.forEach(c=>{c.addEventListener("click",r=>{const s=r.currentTarget.dataset.dishId;console.log(s),s&&p(Number(s)),S?.showModal()}),document.body.style.overflow="auto"})};v();_?.addEventListener("click",()=>{const e=localStorage.getItem("token");if(console.log(d),e===null)d?.showModal(),document.body.style.overflow="auto",g?.addEventListener("submit",async t=>{try{t.preventDefault();const o={membernumber:g.membernumber.value,password:g.loginpassword.value},n=await C(o);console.log("loginData",n),localStorage.setItem("token",n.token),d?.close(),v()}catch(o){console.log(o);const n=o.message+". Kirjautuminen ep채onnistui. Yrit채 uudelleen";a.innerHTML=b(n),a.showModal(),d?.close();const i=document.querySelector("#back-btn-error");i?.addEventListener("click",()=>{a?.close()}),console.log("close button",i),console.log(a)}});else{const t="Olet nyt kirjautunut sis채채n. Nauti tarjouksistasi!";a.innerHTML=k(t),a.showModal(),document.querySelector("#back-btn-success")?.addEventListener("click",()=>{a?.close()})}});
