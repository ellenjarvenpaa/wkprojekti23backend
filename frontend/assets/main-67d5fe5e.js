import{e as b,s as T,a as l,m as D,b as L}from"./style-3a8f6227.js";import{f as h}from"./function-19f4931a.js";const y=async(e,t={})=>{const n=await fetch(e,t);if(!n.ok)throw new Error(`Error ${n.status} occured`);return n.json()},w=await y(l+"api/dish");w.forEach(e=>{const n=(()=>{let o=`
		<h2 id="${e.category_name}">${e.category_name}</h2>
		<ul class="menu-list">
		`;return e.dishes.forEach(c=>{const{dish_photo:u,dish_name:d,dish_price:r,dish_id:i}=c;o+=`
			<li class="menu-item" data-dish-id=${i}>
			<img class="menu-img" src="${l+"media/"+u}" alt="drink">
			<div>
			<p class="menu-item-name">${d}</p>
			<p class="menu-item-price">${r}</p>
			</div>
			</li>
			`}),o+=`
		</ul>
		`,o})();document.querySelector(".menu-items")?.insertAdjacentHTML("beforeend",n)});const I=async e=>{try{let t;const n=localStorage.getItem("token");return n?t=await P(n,e):t=await y(l+`api/dish/${e}`),t}catch(t){return console.error(`Error fetching dish details for dish_id ${e}:`,t),null}},M=document.querySelectorAll(".menu-item");M.forEach(e=>{e.addEventListener("click",t=>{const n=t.currentTarget.dataset.dishId;console.log(n),n&&v(Number(n))})});const v=async e=>{const t=await I(e);if(t){console.log("Dish Details:",t);const{dish_photo:n,dish_name:o,dish_price:c,dish_id:u,description:d,offer_price:r}=t,i=`
		<div class="menu-item" data-dish-id="${u}">
		  <img class="menu-img" src="${l+"media/"+n}" alt="drink">
		  <div>
			<p class="menu-item-name">${o}</p>
			<p>${d}</p>
			<p class="menu-item-price">${r??c}</p>
		  </div>
		</div>
	  `,s=document.querySelector(".info-item");if(s){s.innerHTML="",s.insertAdjacentHTML("beforeend",i);const m=document.querySelector(".quantity-number");m?.addEventListener("change",()=>{if(console.log(m.value),!m?.value)return;const f=+m.value;console.log(f),(isNaN(f)||f<=0)&&(m.value="1")})}else console.error("infoItemContainer is null")}else console.log("Unable to fetch dish details")},B=document.querySelectorAll(".quantity-plus");B.forEach(e=>{e.addEventListener("click",t=>{const n=t.target;console.log("clicked");const o=n?.parentElement?.previousElementSibling;let c=parseInt(o?.value);c++,o.value=c.toString(),console.log(o.value)})});const A=document.querySelectorAll(".quantity-minus");A.forEach(e=>{e.addEventListener("click",t=>{const n=t.target;console.log("clicked");const o=n?.parentElement?.nextElementSibling;let c=parseInt(o?.value);c--,o.value=c.toString()})});const C=document.querySelector("dialog"),E=document.querySelector("#product-info-dialog"),g=document.querySelector("#login-dialog"),S=document.querySelector("#shopping-cart-dialog"),a=document.querySelector("#info"),j=document.querySelectorAll(".menu-item");j.forEach(e=>{e.addEventListener("click",()=>{E?.showModal()})});const $=document.querySelector("#shopping-cart-icon");$?.addEventListener("click",()=>{S?.showModal()});const H=document.querySelector("#back-btn-info");H.addEventListener("click",()=>{C?.close()});const O=document.querySelector("#back-btn-login");O.addEventListener("click",()=>{g?.close()});const _=document.querySelector("#back-btn-cart");_.addEventListener("click",()=>{S?.close()});const p=document.querySelector("#login-form"),x=document.querySelector("#profile-icon"),N=document.querySelector("#login");if(!N)throw new Error("Login button not found");if(!a)throw new Error("Dialog not found");const F=async e=>{const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return await h(l+"api/auth/login",t)},z=async e=>{const t={method:"GET",headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"}};return await h(l+"api/dish/offers",t)},G=async e=>{const t={method:"GET",headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"}};return await h(l+"api/dish/logged",t)},P=async(e,t)=>{const n={method:"GET",headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"}};return await h(l+"api/dish/"+t,n)},q=async()=>{const e=localStorage.getItem("token");if(console.log(e),!e)return;const t=await z(e),n=document.querySelector(".menu-items");n&&(n.innerHTML=""),(r=>{const i=document.querySelector(".menu-items"),s=D(r.offer_dishes);console.log(r),i?.insertAdjacentHTML("afterbegin",s),document.querySelector(".nav-item.discount")?.classList.remove("hidden")})(t);const c=await G(e);console.log(c),(r=>{const i=document.querySelector(".menu-items"),s=L(r);i?.insertAdjacentHTML("beforeend",s)})(c),document.querySelectorAll(".menu-item").forEach(r=>{r.addEventListener("click",i=>{const s=i.currentTarget.dataset.dishId;console.log(s),s&&v(Number(s)),E?.showModal()})})};q();x?.addEventListener("click",()=>{const e=localStorage.getItem("token");if(console.log(g),e===null)g?.showModal(),p?.addEventListener("submit",async t=>{try{t.preventDefault();const n={membernumber:p.membernumber.value,password:p.loginpassword.value},o=await F(n);console.log("loginData",o),localStorage.setItem("token",o.token),g?.close(),q()}catch(n){console.log(n);const o=n.message+". Kirjautuminen ep채onnistui. Yrit채 uudelleen";a.innerHTML=b(o),a.showModal(),g?.close();const c=document.querySelector("#back-btn-error");c?.addEventListener("click",()=>{a?.close()}),console.log("close button",c),console.log(a)}});else{const t="Olet nyt kirjautunut sis채채n. Nauti tarjouksistasi!";a.innerHTML=T(t),a.showModal(),document.querySelector("#back-btn-success")?.addEventListener("click",()=>{a?.close()})}});console.log("cart!");const U=document.querySelectorAll(".remove-btn");for(let e of U)e.addEventListener("click",t=>{console.log("clicked"),t.target?.parentElement?.remove(),k()});const W=document.querySelectorAll(".cart-quantity-number");W.forEach(e=>{e.addEventListener("change",t=>{const n=t.target;if(console.log("change"),!n?.value)return;const o=+n.value;(isNaN(o)||o<=0)&&(n.value="1"),k()})});const k=()=>{const t=document.querySelectorAll(".cart-item-list")[0].querySelectorAll(".cart-item-row");let n=0;t.forEach(u=>{const d=u.querySelector(".price"),r=u.querySelector(".cart-quantity-number");if(!d?.innerText)return;const i=parseFloat(d?.innerText),s=r?.value;s&&(n+=i*parseFloat(s))});const o=n.toFixed(2),c=document.querySelector("#cart-total");c?.innerText&&(c.innerText=o)};
